<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <div class="row">
        <h3>My Google Maps Demo</h3>

        <div class="map" id="map" style="width: 500px; height: 400px;"></div>
        <br>
        <br>
        <input id="track" type="button" value="Отримувати положення таксиста" />
    </div>
    <br>

    <script src="js/signalr.min.js"></script>

    <script>
        let hubUrl = 'https://localhost:44315/route';
        var hubConnection = new signalR.HubConnectionBuilder()
            .withUrl(hubUrl, {
                accessTokenFactory: () => {
                    return "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJxdWlja2RldmVsb3BpbmdAZ21haWwuY29tIiwianRpIjoiZTJkMjY0YTgtNGIzZi00MDI2LWFjMWEtMmEwZDc0ZGI5NmVhIiwiaWF0IjoxNTM1NzE5OTY4LCJpZCI6IjM1ODJiZWU5LWQ1Y2ItNGUwZC04ZDY2LWNlMDc5NjljNmVkMCIsInJvbCI6WyJkcml2ZXJfYWNjZXNzIiwiY3VzdG9tZXJfYWNjZXNzIl0sImN1c3RvbWVySWQiOiJmMmM2NjJhOS0wYjMyLTQwYzktYTFjNS00YmUxZjcyM2U0ZTUiLCJkcml2ZXJJZCI6ImI4ODg4YWQxLTZlODctNGVmNS05NDU2LTY0ODM3ODAxYzNhNCIsIm5iZiI6MTUzNTcxOTk2OCwiZXhwIjoxNTM1NzI3MTY4LCJpc3MiOiJ3ZWJBcGkiLCJhdWQiOiJodHRwOi8vbG9jYWxob3N0OjUyODQxLyJ9.JAlNrxhp6MW4q57jqEm5uk8_acEXFisYopqh4JF_UQY";
                }
            })
            .configureLogging(signalR.LogLevel.Information)
            .build();
        hubConnection.start();

        document.getElementById("track").addEventListener("click", function (e) {
            hubConnection.invoke('ConnectCustomer');
        });

        function initMap() {

            var uluru = { lat: -25.344, lng: 131.036 };
            var map = new google.maps.Map(document.getElementById('map'), { zoom: 10, center: uluru });

            var marker = new google.maps.Marker({ position: uluru, map: map });

            hubConnection.on("postGeoData", function (lat, lon) {
                var latlng = new google.maps.LatLng(lat, lon);
                marker.setPosition(latlng);
                map.setCenter(latlng);
            });
        }
    </script>

</body>
</html>